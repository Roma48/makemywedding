angular.module("widgetkit").controller("customCtrl",["$scope","$timeout","UIkit","mediaInfo","mediaPicker","Fields","Application",function(e,t,i,n,d,o,a){e.content.data._fields||(e.content.data._fields=[]);var l,s=this,m=e.content.data._fields;e.content.data.items&&e.content.data.items.length||(e.content.data.items=[{media:""}]),l=e.content.data.items,e.item=l[0],e.extrafields=m,s.corefields=a.config.types.custom.fields,s.fields=o.fields(),s.previewItem=function(e){var t=e.options&&e.options.media&&e.options.media.poster;return n(t||e.media).image},s.addItem=function(t){e.item=t||{media:""},l.push(e.item)},s.importItems=function(){d.select({multiple:!0}).then(function(t){!t.length||1!=l.length||e.item.title&&e.item.media&&e.item.content||(l.length=0),angular.forEach(t,function(e){s.addItem({title:e.title,media:e.url,width:e.width,height:e.height})})})},s.editItem=function(t){e.item=t},s.deleteItem=function(t){l.splice(l.indexOf(t),1),e.item=l[0]},s.addField=function(e){return e=e||{type:"text",name:"field-x",label:"Field X"},s.corefields[e.name]&&(e.type=s.corefields[e.name].type,e.label=s.corefields[e.name].label),s.hasField(e.name)?void alert('Field name "'+e.name+'" is already in use.'):(l.forEach(function(t){t[e.name]||(t[e.name]="")}),void m.push(angular.copy(e)))},s.deleteField=function(e){l.forEach(function(t){t[e.name]&&delete t[e.name]}),m.splice(m.indexOf(e),1)},s.hasField=function(e){if(["title","media","link"].indexOf(e)>-1)return!0;for(var t=0;t<m.length;t++)if(m[t].name==e)return!0;return!1},s.toggleEditFields=function(){s.editfields=!s.editfields,s.editfields||setTimeout(function(){window.dispatchEvent(new Event("resize"))},150),s.custom={field:{}},s.addCustomField=!1},s.getFieldOptions=function(e){var t={},i=s.corefields[e.name];return i&&i.options&&(t=angular.extend(t,i.options)),JSON.stringify(t)},e.$watch("content",function(t){var i=l.indexOf(e.item);l=t.data.items,e.item=l[i]}),i.$doc.trigger("ready.uk.dom"),i.$doc.on("change.uk.sortable",function(e,i,n){n&&void 0!==n&&(n=angular.element(n),t(function(){"js-content-items"==i.element[0].id&&l.splice(n.index(),0,l.splice(l.indexOf(n.scope().item),1)[0]),"js-fields-items"==i.element[0].id&&m.splice(n.index(),0,m.splice(m.indexOf(n.scope().field),1)[0])}))})}]).run(["$rootScope","mediaInfo",function(e,t){e.$on("wk.preview.content",function(e,i){if("custom"==i.type&&i.data.items.length){var n=i.data.items[0],d=n.options&&n.options.media&&n.options.media.poster;e.preview=t(d||n.media).image.replace(/preview(-.+\.svg)$/g,"content$1")}})}]);