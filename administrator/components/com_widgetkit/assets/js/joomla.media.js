!function(e){angular.module("widgetkit").service("mediaPicker",["$templateCache","$compile","$q","$rootScope","filterFilter","UIkit","mediaRequest","Application",function(t,i,n,o,r,a,l,d){var s,c,p,u,f,m={init:function(r){return this.options=angular.extend({multiple:!1},r),f=n.defer(),c=e(t.get("media")),p=c.data("media-path"),u=i(c)(o).scope(),u.vm=this,this.open("").then(function(){if(window.widgetkit.env.modal){var t=window.widgetkit.env.modal.element.children(":first").hide();m.close=function(){t.show(),c.remove()},t.parent().append(c)}else m.modal=e.UIkit.modal(e('<div class="uk-modal">').append(c).appendTo("body")).show(),m.close=function(){m.modal.hide()},e.UIkit.domObserve(m.modal.element);m.initUpload()}),f.promise},initUpload:function(){var t=e("#wk-upload-progressbar"),i=t.find(".uk-progress-bar"),n={param:"Filedata[]",params:{"Content-Type":"multipart/form-data"},allow:"*.(jpeg|jpg|gif|png|svg|mp3|ogg|wav|mp4|ogv|webm)",before:function(e){e.action=l.url({task:"file.upload",tmpl:"component",format:"html",folder:s},!0)},loadstart:function(){i.css("width","0%").text("0%"),t.removeClass("uk-hidden")},progress:function(e){e=Math.ceil(e)+"%",i.css("width",e).text(e)},allcomplete:function(n){i.css("width","100%").text("100%"),e(n).find(".alert-error, .alert-info")[0]&&a.notify(e(n).find(".alert-error p, .alert-info p").html(),"danger"),setTimeout(function(){t.addClass("uk-hidden")},250),m.open(s)}};a.uploadSelect(e("#wk-upload-select"),n),a.uploadDrop(c,n)},open:function(t){return l.get({view:"mediaList",tmpl:"component",folder:t,layout:"details"}).success(function(i){u.media=[],u.breadcrumbs=[],e(i).find("tbody tr:not(:first)").each(function(){var i=e(this),n=i.find("td:first a"),o=i.find("td :checkbox").val(),r=i.find("td.dimensions").text().trim().split(" x "),a=(t?t+"/":"")+o;u.media.push({title:o,path:a,url:(p?p+"/":"")+a,href:d.baseUrl()+"/"+(p?p+"/":"")+a,type:n.is("[target]")?"folder":"file",image:Boolean(a.match(/\.(jpe?g|png|gif|svg)$/)),width:r[0],height:r[1],size:i.find("td.filesize").text().trim()})}),s=t;var n=(s?"/"+s:"").split("/");do u.breadcrumbs.unshift({path:n.join("/").substr(1),title:n.pop()});while(n.length);u.breadcrumbs[0].title="home"})},select:function(){var e=m.getSelected();e.forEach(function(e){e.title=e.title.replace(/[_-]/g," ").replace(/\.[^\.]+$/,"").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)})}),f.resolve(this.options.multiple||!e.length?e:e[0]),m.close()},addFolder:function(){var e=prompt("Folder Name");e&&l.post({task:"folder.create",foldername:e,folderbase:s}).success(function(){m.open(s)})},remove:function(){window.confirm("Are you sure?")&&l.post({task:"folder.delete",folder:s,rm:m.getSelected().map(function(e){return e.title})}).success(function(){m.open(s)})},getSelected:function(){return r(u.media,{selected:!0})}};return{select:function(e){return m.init(e)}}}]).service("mediaRequest",["$q","$http","Application",function(t,i,n){var o="index.php?option=com_media";return{get:function(e){return i.get(this.url(e))},post:function(t){return t[n.config.token]=1,i.post(o,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},url:function(t,i){return i&&(t[n.config.token]=1),o+"&"+e.param(t)}}}])}(jQuery);